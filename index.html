<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finanzas Ray</title>
    <!-- Iconos de Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Librería de Gráficos (Chart.js) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="estilo.css">
</head>

<body>

    <!-- Overlay de Inicio de Sesión -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <div class="login-header">
                <i class="fas fa-wallet fa-3x"></i>
                <h2>Finanzas Ray</h2>
                <p>Ingresa tus credenciales para continuar</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username"><i class="fas fa-user"></i> Usuario</label>
                    <input type="text" id="username" required placeholder="Tu usuario">
                </div>
                <div class="form-group">
                    <label for="password"><i class="fas fa-lock"></i> Contraseña</label>
                    <input type="password" id="password" required placeholder="Tu contraseña">
                </div>
                <button type="submit" class="btn primary-btn full-width">
                    <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                </button>
                <div id="loginError" class="status-message error" style="margin-top: 15px; display: none;">
                    Credenciales incorrectas. Intenta de nuevo.
                </div>
            </form>
        </div>
    </div>

    <div class="dashboard-container">
        <!-- Barra Lateral -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-wallet"></i> Finanzas Ray
                </div>
                <button class="hamburger-btn" id="hamburgerBtn" aria-label="Toggle menu">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            <nav class="sidebar-nav" id="sidebarNav">
                <a href="#dashboard" class="active" data-section="dashboard">
                    <i class="fas fa-chart-line"></i> Dashboard
                </a>
                <a href="#gastos" data-section="gastos">
                    <i class="fas fa-money-bill-wave"></i> Registrar Gastos
                </a>
                <a href="#ingresos" data-section="ingresos">
                    <i class="fas fa-hand-holding-usd"></i> Registrar Ingresos
                </a>
                <a href="#objetivos" data-section="objetivos">
                    <i class="fas fa-bullseye"></i> Objetivos Financieros
                </a>
                <a href="#prestamos" data-section="prestamos">
                    <i class="fas fa-handshake"></i> Gestión de Préstamos
                </a>
                <a href="#categorias" data-section="categorias">
                    <i class="fas fa-tags"></i> Categorías de Gastos
                </a>
                <a href="#fuentes" data-section="fuentes">
                    <i class="fas fa-stream"></i> Fuentes de Ingreso
                </a>
                <a href="#configuracion" data-section="configuracion">
                    <i class="fas fa-cog"></i> Configuración
                </a>
                <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 15px 0;">
                <a href="#" id="logoutBtn" style="color: var(--danger-color);">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                </a>
            </nav>
        </aside>

        <!-- Contenido Principal -->
        <main class="main-content">

            <!-- Sección 0: Dashboard (Gráficos) -->
            <section id="dashboard" class="content-section active">
                <h2><i class="fas fa-chart-line"></i> Dashboard - Resumen Financiero</h2>

                <!-- Filtros Temporales -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; align-items: center;">
                    <span style="font-weight: bold;">Ver:</span>
                    <button id="filtroDiario" class="btn secondary-btn filtro-activo">
                        <i class="fas fa-calendar-day"></i> Diario
                    </button>
                    <button id="filtroSemanal" class="btn secondary-btn">
                        <i class="fas fa-calendar-week"></i> Semanal
                    </button>
                    <button id="filtroMensual" class="btn secondary-btn">
                        <i class="fas fa-calendar-alt"></i> Mensual
                    </button>
                    <button id="actualizarDashboardBtn" class="btn primary-btn" style="margin-left: auto;">
                        <i class="fas fa-sync"></i> Actualizar
                    </button>
                </div>

                <div id="statusDashboard" class="status-message"></div>

                <!-- Estadísticas Resumen -->
                <div class="stats-grid">
                    <div class="stat-card ingresos">
                        <i class="fas fa-hand-holding-usd fa-2x" style="color: var(--secondary-color);"></i>
                        <div class="stat-value" id="totalIngresos">$0.00</div>
                        <div class="stat-label">Total Ingresos</div>
                    </div>
                    <div class="stat-card gastos">
                        <i class="fas fa-money-bill-wave fa-2x" style="color: var(--danger-color);"></i>
                        <div class="stat-value" id="totalGastos">$0.00</div>
                        <div class="stat-label">Total Gastos</div>
                    </div>
                    <div class="stat-card balance">
                        <i class="fas fa-balance-scale fa-2x" style="color: var(--primary-color);"></i>
                        <div class="stat-value" id="balance">$0.00</div>
                        <div class="stat-label">Balance</div>
                    </div>
                    <div class="stat-card objetivo">
                        <i class="fas fa-bullseye fa-2x" style="color: var(--info-color);"></i>
                        <div class="stat-value" id="progresoObjetivo">0%</div>
                        <div class="stat-label">Progreso Objetivo</div>
                    </div>
                    <div class="stat-card cobrar">
                        <i class="fas fa-file-invoice-dollar fa-2x" style="color: var(--secondary-color);"></i>
                        <div class="stat-value" id="totalCobrar">$0.00</div>
                        <div class="stat-label">Cuentas por Cobrar</div>
                    </div>
                    <div class="stat-card pagar">
                        <i class="fas fa-file-invoice-dollar fa-2x" style="color: var(--danger-color);"></i>
                        <div class="stat-value" id="totalPagar">$0.00</div>
                        <div class="stat-label">Deudas por Pagar</div>
                    </div>
                </div>

                <!-- Gráficas -->
                <div class="chart-container">
                    <canvas id="ingresoVsGastoChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="gastosPorCategoriaChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="evolucionPrestamosChart"></canvas>
                </div>
            </section>

            <!-- Sección 1: Registrar Gastos -->
            <section id="gastos" class="content-section">
                <h2><i class="fas fa-money-bill-wave"></i> Registrar Gastos</h2>
                <form id="gastoForm" class="form-grid">
                    <div class="form-group">
                        <label for="gasto_categoria">Categoría:</label>
                        <select id="gasto_categoria" required>
                            <option value="" disabled selected>Cargando categorías...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="gasto_monto">Monto:</label>
                        <input type="number" id="gasto_monto" required min="0.01" step="0.01" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="gasto_descripcion">Descripción:</label>
                        <input type="text" id="gasto_descripcion" required placeholder="Ej: Pago de luz">
                    </div>
                    <div class="form-group">
                        <label for="gasto_fecha">Fecha:</label>
                        <input type="date" id="gasto_fecha" required>
                    </div>
                    <hr style="grid-column: 1 / -1; margin: 10px 0;">
                    <div class="form-group">
                        <label for="gasto_prestamo_id">Vincular a Préstamo (Opcional):</label>
                        <select id="gasto_prestamo_id">
                            <option value="">Ninguno</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="gasto_tipo_abono">Tipo de Abono:</label>
                        <select id="gasto_tipo_abono">
                            <option value="CAPITAL">Abono a Capital</option>
                            <option value="INTERES">Pago de Interés</option>
                        </select>
                    </div>

                    <button type="submit" class="btn primary-btn full-width">
                        <i class="fas fa-save"></i> Registrar Gasto
                    </button>
                </form>
                <div id="statusGasto" class="status-message"></div>

                <h3 style="margin-top: 30px;">Historial de Gastos</h3>
                <button id="cargarGastosBtn" class="btn secondary-btn">
                    <i class="fas fa-list"></i> Cargar Gastos
                </button>
                <div style="max-height: 400px; overflow-y: auto; margin-top: 15px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Categoría</th>
                                <th>Descripción</th>
                                <th>Monto</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="gastosTableBody">
                            <tr>
                                <td colspan="5">Presiona "Cargar Gastos" para ver el historial.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Sección 2: Registrar Ingresos -->
            <section id="ingresos" class="content-section">
                <h2><i class="fas fa-hand-holding-usd"></i> Registrar Ingresos</h2>
                <form id="ingresoForm" class="form-grid">
                    <div class="form-group">
                        <label for="ingreso_fuente">Fuente:</label>
                        <select id="ingreso_fuente" required>
                            <option value="" disabled selected>Cargando fuentes...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ingreso_monto">Monto:</label>
                        <input type="number" id="ingreso_monto" required min="0.01" step="0.01" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="ingreso_descripcion">Descripción:</label>
                        <input type="text" id="ingreso_descripcion" required placeholder="Ej: Pago quincenal">
                    </div>
                    <div class="form-group">
                        <label for="ingreso_fecha">Fecha:</label>
                        <input type="date" id="ingreso_fecha" required>
                    </div>
                    <hr style="grid-column: 1 / -1; margin: 10px 0;">
                    <div class="form-group">
                        <label for="ingreso_prestamo_id">Vincular a Préstamo (Opcional):</label>
                        <select id="ingreso_prestamo_id">
                            <option value="">Ninguno</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ingreso_tipo_abono">Tipo de Abono:</label>
                        <select id="ingreso_tipo_abono">
                            <option value="CAPITAL">Abono a Capital</option>
                            <option value="INTERES">Pago de Interés</option>
                        </select>
                    </div>

                    <button type="submit" class="btn primary-btn full-width">
                        <i class="fas fa-save"></i> Registrar Ingreso
                    </button>
                </form>
                <div id="statusIngreso" class="status-message"></div>

                <h3 style="margin-top: 30px;">Historial de Ingresos</h3>
                <button id="cargarIngresosBtn" class="btn secondary-btn">
                    <i class="fas fa-list"></i> Cargar Ingresos
                </button>
                <div style="max-height: 400px; overflow-y: auto; margin-top: 15px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Fuente</th>
                                <th>Descripción</th>
                                <th>Monto</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="ingresosTableBody">
                            <tr>
                                <td colspan="5">Presiona "Cargar Ingresos" para ver el historial.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Sección 3: Objetivos Financieros -->
            <section id="objetivos" class="content-section">
                <h2><i class="fas fa-bullseye"></i> Objetivos Financieros</h2>
                <p class="status-message info" style="display:block;">Define tu meta de ahorro y monitorea tu progreso.
                </p>

                <form id="objetivoForm" class="form-grid">
                    <div class="form-group">
                        <label for="objetivo_nombre">Nombre del Objetivo:</label>
                        <input type="text" id="objetivo_nombre" required placeholder="Ej: Ahorrar para vacaciones">
                    </div>
                    <div class="form-group">
                        <label for="objetivo_monto">Monto Meta:</label>
                        <input type="number" id="objetivo_monto" required min="1" step="0.01" placeholder="2000000">
                    </div>
                    <div class="form-group">
                        <label for="objetivo_plazo">Plazo (meses):</label>
                        <input type="number" id="objetivo_plazo" required min="1" placeholder="7">
                    </div>
                    <div class="form-group">
                        <label for="objetivo_fecha_inicio">Fecha de Inicio:</label>
                        <input type="date" id="objetivo_fecha_inicio" required>
                    </div>

                    <button type="submit" class="btn primary-btn full-width">
                        <i class="fas fa-flag-checkered"></i> Crear Objetivo
                    </button>
                </form>
                <div id="statusObjetivo" class="status-message"></div>

                <h3 style="margin-top: 30px;">Objetivo Actual</h3>
                <div id="objetivoActualContainer"
                    style="padding: 20px; background: #f8f9fa; border-radius: 8px; margin-top: 15px;">
                    <p style="text-align: center; color: #666;">No hay objetivo activo. Crea uno arriba.</p>
                </div>
            </section>

            <!-- Sección 4: Gestión de Préstamos -->
            <section id="prestamos" class="content-section">
                <h2><i class="fas fa-handshake"></i> Gestión de Préstamos y Créditos</h2>
                <form id="prestamoForm" class="form-grid">
                    <div class="form-group">
                        <label for="prestamo_tipo">Tipo de Operación:</label>
                        <select id="prestamo_tipo" required>
                            <option value="PRESTADO">DINERO PRESTADO (Yo doy el dinero - Activo)</option>
                            <option value="RECIBIDO">CRÉDITO RECIBIDO (Yo recibo el dinero - Pasivo)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="prestamo_contraparte">Deudor / Acreedor:</label>
                        <input type="text" id="prestamo_contraparte" required
                            placeholder="Ej: Juan Pérez o Banco Nequi">
                    </div>
                    <div class="form-group">
                        <label for="prestamo_monto">Monto Inicial:</label>
                        <input type="number" id="prestamo_monto" required min="1" step="0.01" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="prestamo_tasa">Tasa de Interés (% Anual):</label>
                        <input type="number" id="prestamo_tasa" required min="0" step="0.1" placeholder="0.0">
                    </div>
                    <div class="form-group">
                        <label for="prestamo_plazo">Plazo (Meses):</label>
                        <input type="number" id="prestamo_plazo" required min="1" placeholder="12">
                    </div>
                    <div class="form-group">
                        <label for="prestamo_fecha">Fecha de Inicio:</label>
                        <input type="date" id="prestamo_fecha" required>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="prestamo_notas">Notas / Observaciones:</label>
                        <textarea id="prestamo_notas" rows="2"
                            placeholder="Detalles adicionales del préstamo..."></textarea>
                    </div>

                    <button type="submit" class="btn primary-btn full-width">
                        <i class="fas fa-save"></i> Registrar Préstamo/Crédito
                    </button>
                </form>
                <div id="statusPrestamo" class="status-message"></div>

                <div class="loan-tables-container"
                    style="margin-top: 30px; display: flex; flex-direction: column; gap: 30px;">
                    <div>
                        <h3><i class="fas fa-file-invoice-dollar" style="color: var(--secondary-color);"></i> Cuentas
                            por Cobrar (Mis Préstamos)</h3>
                        <div style="overflow-x: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Contraparte</th>
                                        <th>Monto Inicial</th>
                                        <th>Saldo Actual</th>
                                        <th>Cuota</th>
                                        <th>Tasa %</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="cobrarTableBody">
                                    <tr>
                                        <td colspan="7">Cargando cuentas por cobrar...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div>
                        <h3><i class="fas fa-file-invoice-dollar" style="color: var(--danger-color);"></i> Deudas por
                            Pagar (Mis Créditos)</h3>
                        <div style="overflow-x: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Acreedor</th>
                                        <th>Monto Inicial</th>
                                        <th>Saldo Actual</th>
                                        <th>Cuota</th>
                                        <th>Tasa %</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="pagarTableBody">
                                    <tr>
                                        <td colspan="7">Cargando deudas por pagar...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sección 5: Categorías de Gastos -->
            <section id="categorias" class="content-section">
                <h2><i class="fas fa-tags"></i> Gestión de Categorías de Gastos</h2>
                <form id="categoriaForm" class="form-grid">
                    <div class="form-group">
                        <label for="cat_nombre">Nombre de la Categoría:</label>
                        <input type="text" id="cat_nombre" required placeholder="Ej: Vivienda, Personal, Deuda">
                    </div>
                    <div class="form-group">
                        <label for="cat_color">Color (para gráficos):</label>
                        <input type="color" id="cat_color" value="#007bff">
                    </div>
                    <button type="submit" class="btn secondary-btn full-width">
                        <i class="fas fa-plus"></i> Agregar Categoría
                    </button>
                </form>
                <div id="statusCategoria" class="status-message"></div>

                <h3>Categorías Existentes:</h3>
                <ul id="listaCategorias" style="list-style: none; padding: 0;">
                    <li>Cargando...</li>
                </ul>
            </section>

            <!-- Sección 5: Fuentes de Ingreso -->
            <section id="fuentes" class="content-section">
                <h2><i class="fas fa-stream"></i> Gestión de Fuentes de Ingreso</h2>
                <form id="fuenteForm" class="form-grid single-col">
                    <div class="form-group">
                        <label for="fuente_nombre">Nombre de la Fuente:</label>
                        <input type="text" id="fuente_nombre" required
                            placeholder="Ej: Sueldo, Emprendimiento, Regalías">
                    </div>
                    <button type="submit" class="btn secondary-btn">
                        <i class="fas fa-plus"></i> Agregar Fuente
                    </button>
                </form>
                <div id="statusFuente" class="status-message"></div>

                <h3>Fuentes Existentes:</h3>
                <ul id="listaFuentes" style="list-style: none; padding: 0;">
                    <li>Cargando...</li>
                </ul>
            </section>

            <!-- Sección 6: Configuración -->
            <section id="configuracion" class="content-section">
                <h2><i class="fas fa-cog"></i> Configuración de Base de Datos</h2>
                <div class="config-actions">
                    <p>Esta acción **creará/verificará** las pestañas necesarias en Google Sheet.</p>
                    <button id="iniciarDBBtn" class="btn primary-btn">
                        <i class="fas fa-play-circle"></i> Iniciar Base de Datos
                    </button>

                    <p class="warning-text" style="color: var(--danger-color); font-weight: bold; margin-top: 20px;">
                        ¡ADVERTENCIA! Esta acción eliminará **TODOS** los datos.
                    </p>
                    <button id="resetDBBtn" class="btn danger-btn">
                        <i class="fas fa-sync-alt"></i> Resetear Base de Datos
                    </button>
                </div>
                <div id="statusConfig" class="status-message"></div>
            </section>
        </main>
    </div>

    <script src="script.js"></script>


</body>

</html>